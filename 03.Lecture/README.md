# MongoDB

## Пожизненный сервер Atlas

MondoDB предлагает пожизненную виртуалку с установленной MongoDB на мощностях AWS, AZURE или GCP (Google Cloud Platform) на выбор. Что, самое важное, без привязки к банковской карте пользователя. 
Удивительно, что вышеперечисленные облачные провайдеры, без кредитки даже не позволяют зарегистрироваться в их ЛК.

## Регистрация

Для регистрации необходим ВПН (wireguard, socks, proxy, etc.) с зарубежным ip. Далее, работать с виртуалкой можно будет напрямую без анонимайзеров.

Регистрацию, проводил с помощью привязки к gmail, поэтому рекомендую завести почту на нем. В качестве страны в профиле гугла рекомендую выбрать любую из соседних стран СНГ.

Переходим на сайт регистрации в Атласе https://www.mongodb.com/cloud/atlas/register

<img src=pics/01.png>

И нажимаем кнопку **Sign up with Google**, рекомендую отключить всякие блокировщики, т.к. будут всплывать окна от gmail.com с запросами на предоставления доступа к аккаунту гугла для mongodb. Разрешаем все необходимые доступы: доступ, к ФИО, аватарке и стране. 

После получения необходимого доступа к гуглу, mongoDB предложит принять оферту, ставим галку в поле I accept the Privacy Policy и оферту. Жмем Submit

<img src=pics/02.png>

Далее, заполняем поля по образцу, не забывая выбрать язык программирования Python.

<img src=pics/03.png>

На следующей странице, выбираем тариф M0 Free, который ниже, на зеленом фоне, описан как пожизненный. И это действительно так. AWS, AZURE, GCP, Oracle etc. предлагают также вечные витруалки с минимальными характеристиками, но нужна зарубежная карта, т.к. в случае превышения определенного трафика, либо для подключения доп.услуг облачные провайдеры автоматом списывают с карты деньги. Но, в наше случае, карта, пока, не нужна. Деньги не спишутся. Но, наглеть не надо, т.к. эта лазейка пока открыта, что будет дальше не известно, и в случае блокировки аккаунта, зарегаться возможно не получиться без кредитки.

<img src=pics/04.png>

На следующем экране, после нажатия кнопки Create Deployment, обязательно копируем и сохраняем имя пользователя и пароль.

<img src=pics/05.png>

После сохранения пароля в надежном месте, сначала нажимаем Create Database User (создать пользователя БД)

<img src=pics/06.png>

Затем, нажимаем Choose a connection method (Выбор метода подключения).

В окне выбора метода подключения, нужен драйвер для Python, у кого свежий пайтон, версию не меняет, для совместимости со старыми версиями выбрал 3.6 or later.

<img src=pics/07.png>

Ниже, будет образец кода для подключения с помощью пайтона, его копируем, он пригодится для кодинга. В него уже встроены ваши учетные данные.

<img src=pics/08.png>

После нажатия на Review setup steps, появится окно со строкой кода, копируем ее, она понадобится для настройки Visual Studio Code.

Жмем Done.

<img src=pics/09.png>

После завершения (Done), оказываемся в ЛК, в котором слева внизу будут гореть зеленые плашки. Рекомендую сразу нажать на ссылку в одной из плашек IP Access List

<img src=pics/10.png>

Необходимо задать диапазон ip-адресов, с которых разрешен доступ к нашему, только что созданному инстансу. Можно, разрешить доступ со всех адресов (см.далее)

<img src=pics/11.png>

После нажатия Confirm видим список диапазонов адресов с которых разрешен доступ.

<img src=pics/12.png>

Что бы добавить еще диапазон, либо разрешить вообще все адреса, нажимаем зеленую кнопку ADD IP ADDRESS

<img src=pics/13.png>

Вводим шаблон 0.0.0.0/0 - означающий всевозможные адреса.


Основные настройки закончены. У кого не появились плашки с ip-адресами либо, кто хочет изменить из позже в ЛК слева в главном меню, в разделе Security, выбирает Network Access.

## Настройка клиентов mongoDB

Переходим к настройке Visual Studio Code или shell клиента mongodb. Для этого в главном левом меню, раздел Deployment, выбираем Database. И далее посредине экрана ищем кнопку Connect.

<img src=pics/15.png>

После нажатия на Connect появляется меню выбора способов подключения с помощью различных клиентов, один из которых Shell, а другой популярный VSC.

<img src=pics/16.png>

После выбора Shell, меню сайта предложит для необходимой операционной системы скачать ПО. Не забываем скопировать строку с кодом, она необходима для настройки свежескаченного и установленного ПО.

<img src=pics/17.png>

Кому удобнее работать с VSC, а не с shell, возвращается на шаг к выбору метода и ниже есть строка с описанием процедуры настройки VSC.

<img src=pics/18.png>

Устанавливаем в VSC плагин MongoDB for VS Code

<img src=pics/19.png>

После установки плагин, он предложит подключиться к серверу mongodb, нажимаем кнопку Connect в окне плагина.

<img src=pics/20.png>

Наверху VSC в окне команд появится строка, в которую нужно вставить код сохраненный ранее, он имеет вид

```
mongodb+srv://USER:PASSWORD@cluster0.HOST.mongodb.net/admin
```
- USER - ваш логин
- PASSWORD - ваш пароль
- HOST - ваш хост

Чтобы хост стал преобразовываться в ip-адрес, DNS-зоне необходимо мигрировать по всем корневым серверам и далее на вашего локального поставщика днс-услуг. В среднем это занимает от 10 до 100 минут.

После этого можно работать с помощью любимого клиента MongoDB или настроить самостоятельно доступ по API.

<img src=pics/21.png>